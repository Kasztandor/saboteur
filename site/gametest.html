<!DOCTYPE html>
<html>
    <head>
        <title>Saboteur</title>
        <meta charset="utf-8">
        <style>
            @import url('fontello/css/fontello.css');

            html, body{
                margin: 0;
                padding: 0;
                height: 100%;
                text-align: center;
                --mouseX: -1000;
                --mouseY: -1000;
            }
            #topbar{
                display: flex;
            }
            #topbar, #bottombar{
                height: 10vh;
                background-color: #3f3f3f;
                color: white;
            }
            #left, #center, #rigth{
                width: 20%;
                background-color: #3f3f3f;
            }
            #center{
                width: 60%;
            }
            #game{
                height: 80vh;
                background-color: black;
                position: relative;
                overflow: hidden;
                cursor: none;
            }
            #resetPosition{
                position: absolute;
                right: 10px;
                top: calc(10px + 10vh);
                text-align: center;
                width: 40px;
                height: 40px;
                line-height: 40px;
                border-radius: 5px;
                color: white;
                background: #3f3f3f;
                display: none;
            }
            #resetPosition:hover{
                background-color: #757575;
                color: black;
                cursor: pointer;
            }
            .card{ /* 240x300 */
                --xShift: 0;
                --yShift: 0;
                --height: calc(var(--cardHeight) * 1px); 
                --width: calc(var(--height) * 0.8);
                background-color: #3f3f3f;
                height: var(--height);
                width: var(--width);
                position: absolute;
                left: calc(50% + var(--xShift)*var(--width) - var(--x) * 1px);
                top: calc(50% - var(--yShift)*var(--height) - var(--y) * 1px);
                transform: translate(-50%, -50%);
            }
            .card img{
                width: 100%;
            }
            img{
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -o-user-select: none;
                user-select: none;
            }
            #circle{
                --circleSize: calc(var(--cardHeight) * 2px);
                --circleLeft: calc(var(--mouseX) * 1px - var(--circleSize) / 2);
                --circleTop: calc(var(--mouseY) * 1px - var(--circleSize) / 2 - 10vh);
                position: absolute;
                left: var(--circleLeft);
                top: var(--circleTop);
                width: var(--circleSize);
                height: var(--circleSize);
                border-radius: 50%;
                overflow: hidden;
                background: radial-gradient(rgba(255, 255, 255, 0.5), rgba(0, 0, 0, 0), rgba(0, 0, 0, 0));
            }
            .barH, .barV{
                position: absolute;
                top: 0;
                left: 0;
                width: 2px;
                height: 2px; 
                background: #757575;
            }
            .barH{
                height: 100%;
                left: calc((50vw + var(--cardHeight)*0.4px*var(--factor) + var(--cardX)*var(--cardHeight)*0.8px - var(--x)*1px) - var(--circleLeft));
                transform: translate(-50%, 0);
            }
            .barV{
                width: 100%;
                top: calc(40vh + var(--cardHeight)*0.5px*var(--factor) - var(--cardY)*var(--cardHeight)*-1px - var(--y)*1px - var(--circleTop));
                transform: translate(0, -50%);
            }
        </style>
    </head>
    <body style="--x: 0; --y: 0;">
        <div id="topbar">
            <div id="left"></div>
            <div id="center"></div>
            <div id="rigth"></div>
        </div>
        <div id="game">
            <div id="cards">
                <div class="card" style="--xShift: -4; --yShift: 0;">
                    <img src="cards/enter.png" alt="enter">
                </div>
                <div class="card" style="--xShift: 4; --yShift: 2;">
                    <img src="cards/hidden.png" alt="enter">
                </div>
                <div class="card" style="--xShift: 4; --yShift: 0;">
                    <img src="cards/hidden.png" alt="enter">
                </div>
                <div class="card" style="--xShift: 4; --yShift: -2;">
                    <img src="cards/hidden.png" alt="enter">
                </div>
            </div>
            <div id="circle">
                <div class="barH" style="--factor: -3;"></div>
                <div class="barV" style="--factor: -3;"></div>
                <div class="barH" style="--factor: -1;"></div>
                <div class="barV" style="--factor: -1;"></div>
                <div class="barH" style="--factor: 1;"></div>
                <div class="barV" style="--factor: 1;"></div>
                <div class="barH" style="--factor: 3;"></div>
                <div class="barV" style="--factor: 3;"></div>
            </div>
        </div>
        <div id="bottombar"></div>
        <div id="resetPosition" onclick="resetPosition()"><i class="icon-arrows-cw"></i></div>
        <script>
            let moving = false, autoMoving = false
            let cardHeight = 90
            let cardWidth = cardHeight*.8
            document.body.style.setProperty("--cardHeight", cardHeight)
            let x=0, xx=0, xxx=0, cardPosX=0
            let y=0, yy=0, yyy=0, cardPosY=0
            function placeCard(card, x, y){
                document.querySelector("#cards").innerHTML +=`
                <div class="card" style="--xShift: ${x}; --yShift: ${y};">
                    <img src="cards/${card}.png" alt="enter">
                </div>
                `
            }
            function removeCard(x, y){
                for (i in document.querySelectorAll(".card")){
                    if (document.querySelectorAll(".card")[i].style.getPropertyValue("--xShift") == x && document.querySelectorAll(".card")[i].style.getPropertyValue("--yShift") == y){
                        document.querySelectorAll(".card")[i].remove()
                    }
                }
            }
            function updateValues(){
                document.body.style.setProperty("--x", x)
                document.body.style.setProperty("--y", y)
                document.body.style.setProperty("--mouseX", xx)
                document.body.style.setProperty("--mouseY", yy)
                cardPosX = Math.round((xx + x - window.innerWidth/2) / cardWidth)
                cardPosY = Math.round((yy + y - window.innerHeight/2) / cardHeight)
                document.body.style.setProperty("--cardX", cardPosX)
                document.body.style.setProperty("--cardY", cardPosY)
            }
            function resetPosition(){
                if (autoMoving == false){
                    autoMoving = true
                    let initialX = x, initialY = y
                    for (let i=0; i<50; i++){
                        setTimeout(function(j=i){
                            x = initialX*j
                            updateValues()
                        },i*20)
                    }
                    setTimeout(function(){
                        x = 0, y = 0
                        updateValues()
                        document.querySelector("#resetPosition").style.setProperty("display", "none")
                        autoMoving = false
                    },1000)
                }
            }
            document.onmousemove = function(e){
                xx = e.clientX
                yy = e.clientY
                if(moving && autoMoving == false){
                    x += xxx - xx
                    y += yyy - yy
                    xxx = xx
                    yyy = yy
                }
                updateValues()
            }
            document.querySelector("#game").onpointerdown = function(e){
                if (e.buttons == 1){
                    moving = true
                    xxx = e.clientX
                    yyy = e.clientY 
                }
            }
            document.onpointerup = function(e){
                moving = false
                if (x==0 && y==0){
                    document.querySelector("#resetPosition").style.setProperty("display", "none")
                }
                else{
                    document.querySelector("#resetPosition").style.setProperty("display", "block")
                }
            }
            document.querySelector("#game").onwheel = function(e){
                let multiplayer
                if(e.deltaY > 0){
                    if (cardHeight <= 20) return
                    multiplayer = -1
                }else{
                    multiplayer = 1
                }
                // motion relative to center of screen
                //x += x/cardWidth*4*multiplayer
                //y += y/cardHeight*5*multiplayer
                // motion relative to cursor
                x += Math.round((((xx-window.innerWidth/2)+x)/cardWidth)*4*multiplayer)
                y += Math.round((((yy-window.innerHeight/2)+y)/cardHeight)*5*multiplayer)
                cardHeight += 5*multiplayer
                cardWidth = cardHeight*.8
                document.body.style.setProperty("--cardHeight", cardHeight)
                updateValues()
            }
        </script>
    </body>
</html>